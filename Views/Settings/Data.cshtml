@{
    ViewData["Title"] = "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h2>
    <a href="/settings" class="btn btn-outline-secondary">‚Üê –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
</div>

<div class="row g-4">
    <!-- Export Data -->
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">–°–∫–∞—á–∞–π—Ç–µ –≤—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞ –≤ –¥—Ä—É–≥–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.</p>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="export-option">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div class="me-3" style="font-size: 24px;">üìÑ</div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">JSON —Ñ–æ—Ä–º–∞—Ç</h6>
                                    <small class="text-muted">–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π</small>
                                </div>
                                <button class="btn btn-outline-primary btn-sm" onclick="exportData('json')">
                                    –°–∫–∞—á–∞—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="export-option">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div class="me-3" style="font-size: 24px;">üìä</div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">CSV —Ñ–æ—Ä–º–∞—Ç</h6>
                                    <small class="text-muted">–¢–∞–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</small>
                                </div>
                                <button class="btn btn-outline-success btn-sm" onclick="exportData('csv')">
                                    –°–∫–∞—á–∞—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-4">
                    <h6 class="alert-heading">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —ç–∫—Å–ø–æ—Ä—Ç–µ</h6>
                    <ul class="mb-0">
                        <li>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –∑–∞–º–µ—Ç–∫–∏, —Ü–µ–ª–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</li>
                        <li>JSON —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö</li>
                        <li>CSV —É–¥–æ–±–µ–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤ Excel –∏–ª–∏ Google Sheets</li>
                        <li>–§–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ –≤–∞—à–∏ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Data Management -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üóÇÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="data-action">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div class="me-3" style="font-size: 24px;">üßπ</div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">–û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ</h6>
                                    <small class="text-muted">–£–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫–∏ —Å—Ç–∞—Ä—à–µ 1 –≥–æ–¥–∞</small>
                                </div>
                                <button class="btn btn-outline-warning btn-sm" onclick="cleanOldData()">
                                    –û—á–∏—Å—Ç–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="data-action">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div class="me-3" style="font-size: 24px;">üîÑ</div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</h6>
                                    <small class="text-muted">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞</small>
                                </div>
                                <button class="btn btn-outline-info btn-sm" onclick="syncData()">
                                    –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Statistics -->
    <div class="col-lg-4">
        <!-- Storage Info -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">üíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</h6>
            </div>
            <div class="card-body">
                <div class="storage-info">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>–ó–∞–º–µ—Ç–∫–∏</span>
                        <span class="text-muted">~2.5 MB</span>
                    </div>
                    <div class="progress mb-3" style="height: 6px;">
                        <div class="progress-bar bg-primary" style="width: 25%"></div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>–¶–µ–ª–∏</span>
                        <span class="text-muted">~0.8 MB</span>
                    </div>
                    <div class="progress mb-3" style="height: 6px;">
                        <div class="progress-bar bg-success" style="width: 8%"></div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                        <span class="text-muted">~0.2 MB</span>
                    </div>
                    <div class="progress mb-3" style="height: 6px;">
                        <div class="progress-bar bg-info" style="width: 2%"></div>
                    </div>
                    
                    <hr>
                    <div class="d-flex justify-content-between align-items-center">
                        <strong>–í—Å–µ–≥–æ</strong>
                        <strong>~3.5 MB</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Backup Info -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">üîÑ –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</h6>
            </div>
            <div class="card-body">
                <div class="backup-info">
                    <div class="backup-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>–ü–æ—Å–ª–µ–¥–Ω–∏–π —ç–∫—Å–ø–æ—Ä—Ç</span>
                            <span class="text-muted">–ù–µ —Å–æ–∑–¥–∞–Ω</span>
                        </div>
                    </div>
                    
                    <div class="backup-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–ø–∏–∏</span>
                            <span class="text-success">–í–∫–ª—é—á–µ–Ω—ã</span>
                        </div>
                    </div>
                    
                    <div class="backup-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>–ß–∞—Å—Ç–æ—Ç–∞</span>
                            <span class="text-muted">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</span>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-outline-primary btn-sm w-100" onclick="createBackup()">
                        üì¶ –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                    </button>
                </div>
            </div>
        </div>

        <!-- Data Safety -->
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö</h6>
            </div>
            <div class="card-body">
                <div class="safety-info">
                    <div class="safety-item">
                        <div class="d-flex align-items-center mb-2">
                            <span class="me-2">üîê</span>
                            <span>–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</span>
                        </div>
                        <small class="text-success">–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã</small>
                    </div>
                    
                    <div class="safety-item">
                        <div class="d-flex align-items-center mb-2">
                            <span class="me-2">üõ°Ô∏è</span>
                            <span>–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å</span>
                        </div>
                        <small class="text-success">–î–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º</small>
                    </div>
                    
                    <div class="safety-item">
                        <div class="d-flex align-items-center mb-2">
                            <span class="me-2">üìã</span>
                            <span>GDPR</span>
                        </div>
                        <small class="text-success">–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º GDPR</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Danger Zone -->
<div class="card mt-4 border-danger">
    <div class="card-header bg-danger-subtle">
        <h5 class="mb-0 text-danger">‚ö†Ô∏è –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h5>
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-8">
                <h6 class="text-danger">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</h6>
                <p class="text-muted mb-0">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –í—Å–µ –≤–∞—à–∏ –∑–∞–º–µ—Ç–∫–∏, —Ü–µ–ª–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ —É–¥–∞–ª–µ–Ω—ã.</p>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-danger" onclick="showDeleteConfirmation()">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger-subtle">
                <h5 class="modal-title text-danger">‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-danger"><strong>–í–ù–ò–ú–ê–ù–ò–ï!</strong> –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
                <p>–í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ —É–¥–∞–ª–µ–Ω—ã:</p>
                <ul>
                    <li>–í—Å–µ –∑–∞–º–µ—Ç–∫–∏ –∏ —ç–º–æ—Ü–∏–∏</li>
                    <li>–í—Å–µ —Ü–µ–ª–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å</li>
                    <li>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</li>
                    <li>–ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</li>
                </ul>
                
                <div class="mt-3">
                    <label for="deleteConfirmation" class="form-label">–í–≤–µ–¥–∏—Ç–µ "–£–î–ê–õ–ò–¢–¨" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</label>
                    <input type="text" class="form-control" id="deleteConfirmation" placeholder="–£–î–ê–õ–ò–¢–¨">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-danger" onclick="confirmDelete()">–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞</button>
            </div>
        </div>
    </div>
</div>

<style>
.export-option, .data-action {
    transition: all 0.2s ease;
}

.export-option:hover, .data-action:hover {
    background: #f8f9fa;
    border-color: #6b7cff !important;
}

.storage-info, .backup-info, .safety-info {
    space-y: 15px;
}

.backup-item, .safety-item {
    padding: 8px 0;
    border-bottom: 1px solid #f3f4f6;
}

.backup-item:last-child, .safety-item:last-child {
    border-bottom: none;
}

.card {
    transition: transform 0.2s ease;
}

.card:hover {
    transform: translateY(-2px);
}
</style>

<script>
function exportData(format) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/settings/export';
    
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'format';
    input.value = format;
    
    form.appendChild(input);
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
}

function cleanOldData() {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫–∏ —Å—Ç–∞—Ä—à–µ 1 –≥–æ–¥–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã AJAX –∑–∞–ø—Ä–æ—Å
        showToast('–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'success');
    }
}

function syncData() {
    showToast('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'info');
}

function createBackup() {
    showToast('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞', 'success');
}

function showDeleteConfirmation() {
    const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
    modal.show();
}

function confirmDelete() {
    const confirmation = document.getElementById('deleteConfirmation').value;
    
    if (confirmation !== '–£–î–ê–õ–ò–¢–¨') {
        alert('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–µ–≤–µ—Ä–Ω–æ–µ. –í–≤–µ–¥–∏—Ç–µ "–£–î–ê–õ–ò–¢–¨" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.');
        return;
    }
    
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã AJAX –∑–∞–ø—Ä–æ—Å
    fetch('/settings/delete-account', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ confirmation: confirmation })
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert(result.message);
            bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
        } else {
            alert(result.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö');
    });
}

function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = 'toast-notification';
    toast.textContent = message;
    
    const colors = {
        success: '#10b981',
        error: '#ef4444',
        info: '#3b82f6',
        warning: '#f59e0b'
    };
    
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${colors[type]};
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        z-index: 1000;
        animation: slideIn 0.3s ease;
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}
</script>
